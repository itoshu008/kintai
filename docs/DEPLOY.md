# ğŸš€ ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¬ã‚¤ãƒ‰

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ‡ãƒ—ãƒ­ã‚¤æ–¹æ³•ã‚’èª¬æ˜ã—ã¾ã™ã€‚

## ğŸ“‹ å‰ææ¡ä»¶

- Node.js 18ä»¥ä¸Š
- Git
- PM2 (æœ¬ç•ªç’°å¢ƒ)
- Nginx (æœ¬ç•ªç’°å¢ƒ)

## ğŸ”§ ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

### 1. æœ¬æ ¼ç‰ˆãƒ‡ãƒ—ãƒ­ã‚¤ã‚¹ã‚¯ãƒªãƒ—ãƒˆ (æ¨å¥¨)

```bash
# ã‚µãƒ¼ãƒãƒ¼ã§å®Ÿè¡Œ
./deploy-ploi.sh
```

**æ©Ÿèƒ½:**
- âœ… è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆ
- âœ… ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- âœ… ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
- âœ… ãƒ­ã‚°å‡ºåŠ›
- âœ… å¤ã„ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—

### 2. ç°¡æ˜“ç‰ˆãƒ‡ãƒ—ãƒ­ã‚¤ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

```bash
# ã‚µãƒ¼ãƒãƒ¼ã§å®Ÿè¡Œ
./deploy-simple.sh
```

**æ©Ÿèƒ½:**
- âœ… åŸºæœ¬çš„ãªãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †
- âœ… è»½é‡ã§é«˜é€Ÿ

### 3. Windowsç”¨ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

```powershell
# PowerShellã§å®Ÿè¡Œ
.\deploy-windows.ps1
```

**æ©Ÿèƒ½:**
- âœ… Windowsç’°å¢ƒç”¨
- âœ… PowerShellå¯¾å¿œ

## ğŸ› ï¸ æ‰‹å‹•ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †

### 1. ã‚³ãƒ¼ãƒ‰ã®æ›´æ–°

```bash
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•
cd /home/zatint1991-hvt55/zatint1991.com

# æœ€æ–°ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—
git fetch origin
git reset --hard origin/main
```

### 2. ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# ãƒ«ãƒ¼ãƒˆã®ä¾å­˜é–¢ä¿‚
npm ci

# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ä¾å­˜é–¢ä¿‚
cd backend
npm ci
cd ..

# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ä¾å­˜é–¢ä¿‚
cd frontend
npm ci
cd ..
```

### 3. ãƒ“ãƒ«ãƒ‰å®Ÿè¡Œ

```bash
# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ“ãƒ«ãƒ‰
cd backend
npm run build
cd ..

# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ“ãƒ«ãƒ‰
cd frontend
npm run build
cd ..
```

### 4. ãƒ—ãƒ­ã‚»ã‚¹å†èµ·å‹•

```bash
# PM2ã§å†èµ·å‹•
pm2 restart all

# ã¾ãŸã¯å€‹åˆ¥ã«å†èµ·å‹•
pm2 restart kintai-backend
```

## ğŸ” ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã®ç¢ºèª

### 1. ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯

```bash
# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
curl http://localhost:8000/api/admin/backups/health

# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ç¢ºèª
curl http://localhost:3000
```

### 2. ãƒ­ã‚°ç¢ºèª

```bash
# PM2ã®ãƒ­ã‚°ç¢ºèª
pm2 logs

# ç‰¹å®šã®ãƒ—ãƒ­ã‚»ã‚¹ã®ãƒ­ã‚°
pm2 logs kintai-backend
```

### 3. ãƒ—ãƒ­ã‚»ã‚¹çŠ¶æ…‹ç¢ºèª

```bash
# PM2ã®çŠ¶æ…‹ç¢ºèª
pm2 status

# è©³ç´°æƒ…å ±
pm2 show kintai-backend
```

## âš™ï¸ ç’°å¢ƒè¨­å®š

### æœ¬ç•ªç’°å¢ƒè¨­å®š

```bash
# ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼
cp backend/env.production backend/.env

# å¿…è¦ã«å¿œã˜ã¦ç·¨é›†
nano backend/.env
```

### Nginxè¨­å®šä¾‹

```nginx
server {
    listen 80;
    server_name zatint1991.com;

    # ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
    location / {
        root /home/zatint1991-hvt55/zatint1991.com/frontend/dist;
        try_files $uri $uri/ /index.html;
    }

    # ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰API
    location /api/ {
        proxy_pass http://127.0.0.1:8000;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

## ğŸš¨ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œ

1. **ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼**
   ```bash
   # ä¾å­˜é–¢ä¿‚ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
   rm -rf node_modules package-lock.json
   npm install
   ```

2. **PM2ãƒ—ãƒ­ã‚»ã‚¹ãŒèµ·å‹•ã—ãªã„**
   ```bash
   # PM2ã‚’ãƒªã‚»ãƒƒãƒˆ
   pm2 delete all
   pm2 start backend/dist/index.js --name "kintai-backend"
   ```

3. **æ¨©é™ã‚¨ãƒ©ãƒ¼**
   ```bash
   # æ¨©é™ã‚’ä¿®æ­£
   chmod +x backend/dist/index.js
   chmod -R 755 frontend/dist
   ```

### ãƒ­ã‚°ã®å ´æ‰€

- **PM2ãƒ­ã‚°**: `~/.pm2/logs/`
- **Nginxãƒ­ã‚°**: `/var/log/nginx/`
- **ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚°**: ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›

## ğŸ“ ã‚µãƒãƒ¼ãƒˆ

å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã€ä»¥ä¸‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š

1. ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹
2. ãƒ—ãƒ­ã‚»ã‚¹ã®çŠ¶æ…‹
3. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶š
4. ãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡

---

**ğŸ‰ ãƒ‡ãƒ—ãƒ­ã‚¤ãŒå®Œäº†ã—ãŸã‚‰ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼**
