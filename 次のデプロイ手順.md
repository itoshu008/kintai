# 🔥 解決方法：権限エラーを回避する新しいデプロイ

## 問題の原因

古い `ploi-home-deploy.sh` スクリプトを実行しているため、`rm -rf node_modules` が実行され、権限エラーが発生しています。

## ✅ 解決方法

**重要：** 新しい `ploi-simple-deploy.sh` スクリプトを使用してください。このスクリプトは：

- ✅ **node_modules を一切削除しません**
- ✅ **既存の依存関係をそのまま使用**
- ✅ **ビルドアーティファクトのみクリーンアップ**
- ✅ **権限エラーを完全に回避**

## Plioサーバーで実行するコマンド

```bash
# 1. アプリケーションディレクトリに移動
cd /home/zatint1991-hvt55/zatint1991.com

# 2. 最新コードを取得
git pull origin main

# 3. 新しいシンプルデプロイスクリプトに実行権限を付与
chmod +x ploi-simple-deploy.sh

# 4. 新しいスクリプトを実行（これが重要！）
./ploi-simple-deploy.sh
```

## ⚠️ 重要な注意事項

- **`ploi-home-deploy.sh` は実行しないでください** - 古いスクリプトです
- **`ploi-simple-deploy.sh` を実行してください** - 新しい、安全なスクリプトです

## 🔍 スクリプトの違い

### ❌ 古いスクリプト (`ploi-home-deploy.sh`)
```bash
rm -rf node_modules  # ← これが権限エラーの原因
npm install
```

### ✅ 新しいスクリプト (`ploi-simple-deploy.sh`)
```bash
# node_modules には一切触れない
rm -rf dist .vite-temp tsconfig.tsbuildinfo  # ビルドアーティファクトのみ削除
npm run build  # 既存のnode_modulesを使用してビルド
```

## デプロイ後の確認

1. ブラウザで `https://zatint1991.com` にアクセス
2. ログインページが表示されることを確認
3. 管理画面 `https://zatint1991.com/admin-dashboard-2024` が動作することを確認

## トラブルシューティング

もしまだエラーが出る場合は、以下を確認してください：

```bash
# 正しいスクリプトを実行したか確認
ls -la ploi-simple-deploy.sh

# スクリプトの内容を確認（node_modules を削除する行がないことを確認）
grep -n "node_modules" ploi-simple-deploy.sh
# 出力: 何も表示されないはずです（node_modules を削除する行がないため）

# PM2の状態を確認
pm2 status

# バックエンドログを確認
pm2 logs attendance-app --lines 50
```


