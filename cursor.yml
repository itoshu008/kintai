# Cursor設定ファイル - 勤怠管理システム
# TypeScriptビルドとバックエンド起動の自動化

steps:
  - name: "依存関係インストール (フロントエンド)"
    command: "cd frontend && npm install"
    working_directory: "."
    
  - name: "依存関係インストール (バックエンド)"
    command: "cd backend && npm install"
    working_directory: "."
    
  - name: "TypeScriptビルド (フロントエンド)"
    command: "cd frontend && npm run build"
    working_directory: "."
    
  - name: "TypeScriptビルド (バックエンド)"
    command: "cd backend && npm run build"
    working_directory: "."
    
  - name: "PM2プロセス停止 (既存)"
    command: "pm2 delete kintai-backend || true"
    working_directory: "."
    
  - name: "バックエンド起動 (PM2)"
    command: "pm2 start backend-pm2.config.js"
    working_directory: "."
    
  - name: "ヘルスチェック"
    command: "timeout 5 && curl http://localhost:8001/api/admin/health"
    working_directory: "."

# 開発用ショートカット
dev_shortcuts:
  - name: "フロントエンドのみビルド"
    command: "cd frontend && npm run build"
    
  - name: "バックエンドのみビルド"
    command: "cd backend && npm run build"
    
  - name: "PM2再起動"
    command: "pm2 restart kintai-backend"
    
  - name: "PM2ログ確認"
    command: "pm2 logs kintai-backend --lines 20"
    
  - name: "PM2ステータス確認"
    command: "pm2 status"

# 環境変数
env:
  NODE_ENV: "development"
  PORT: "8001"
  HOST: "127.0.0.1"
  BACKUP_ENABLED: "1"
  BACKUP_INTERVAL_MINUTES: "60"
  BACKUP_MAX_KEEP: "24"

